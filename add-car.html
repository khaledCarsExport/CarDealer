<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sell Your Car - Khaled Cars</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <i class="fas fa-car"></i>
                <span>Khaled Cars</span>
            </a>
           <div class="nav-links">
    <a href="index.html">Home</a>
    <a href="inventory.html">Inventory</a>
    <!-- "Sell Your Car" and "Admin" links removed -->
    <a href="tel:+1234567890" class="btn-call">
        <i class="fas fa-phone"></i> Call Now
    </a>
</div>
            <button class="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Sell Your Car With Us</h1>
            <p>Get the best value for your vehicle. Fast, transparent, and hassle-free.</p>
        </div>
    </section>

    <!-- Sell Form -->
    <section class="sell-form">
        <div class="container">
            <div class="form-container">
                <div class="form-info">
                    <h2><i class="fas fa-check-circle"></i> Why Sell With Us?</h2>
                    <ul>
                        <li><i class="fas fa-dollar-sign"></i> <strong>Best Price Guaranteed</strong> - Get competitive offers</li>
                        <li><i class="fas fa-bolt"></i> <strong>Fast Process</strong> - Sell your car in 24 hours</li>
                        <li><i class="fas fa-shield-alt"></i> <strong>Safe & Secure</strong> - All paperwork handled</li>
                        <li><i class="fas fa-car"></i> <strong>Free Inspection</strong> - Professional evaluation</li>
                        <li><i class="fas fa-money-bill-wave"></i> <strong>Instant Payment</strong> - Get paid immediately</li>
                    </ul>
                    
                    <div class="contact-box">
                        <h3><i class="fas fa-headset"></i> Need Help?</h3>
                        <p>Our team is ready to assist you</p>
                        <a href="tel:+213549883720" class="btn-call-large">
                            <i class="fas fa-phone"></i> Call: (213) 549883720
                        </a>
                    </div>
                </div>
                
                <div class="form-content">
                    <h2>Car Details</h2>
                    <form id="carForm">
                        <input type="hidden" id="carId">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="brand">Brand *</label>
                                <select id="brand" required>
                                    <option value="">Select Brand</option>
                                    <option value="Toyota">Toyota</option>
                                    <option value="BMW">BMW</option>
                                    <option value="Mercedes">Mercedes</option>
                                    <option value="Audi">Audi</option>
                                    <option value="Honda">Honda</option>
                                    <option value="Ford">Ford</option>
                                    <option value="Chevrolet">Chevrolet</option>
                                    <option value="Nissan">Nissan</option>
                                    <option value="Hyundai">Hyundai</option>
                                    <option value="Kia">Kia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="model">Model *</label>
                                <input type="text" id="model" placeholder="e.g., Camry, X5, etc." required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="year">Year *</label>
                                <select id="year" required>
                                    <option value="">Select Year</option>
                                    ${Array.from({length: 25}, (_, i) => {
                                        const year = new Date().getFullYear() - i;
                                        return `<option value="${year}">${year}</option>`;
                                    }).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="price">Expected Price (M) *</label>
                                <input type="number" id="price" step="0.01" placeholder="e.g., 25.50" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="kilometrage">Kilometrage *</label>
                                <input type="number" id="kilometrage" placeholder="e.g., 15000" required>
                            </div>
                            <div class="form-group">
                                <label for="boite">Transmission *</label>
                                <select id="boite" required>
                                    <option value="">Select</option>
                                    <option value="Automatic">Automatic</option>
                                    <option value="Manual">Manual</option>
                                    <option value="CVT">CVT</option>
                                    <option value="Semi-Auto">Semi-Automatic</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="version">Version/Trim *</label>
                            <input type="text" id="version" placeholder="e.g., LE, Sport, Luxury, etc." required>
                        </div>
                        
                        <div class="form-group">
                            <label for="description">Additional Details</label>
                            <textarea id="description" placeholder="Describe your car's condition, features, maintenance history, etc." rows="4"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Upload Photos & Videos</label>
                            <p class="help-text">Upload clear photos from all angles. Videos are welcome. Max 150MB per file.</p>
                            <div class="file-upload-area" onclick="document.getElementById('mediaInput').click()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Click to upload or drag & drop</p>
                                <p class="file-types">JPG, PNG, MP4, WebM up to 150MB</p>
                                <input type="file" id="mediaInput" multiple accept="image/*,video/*" onchange="handleMediaUpload(event)">
                            </div>
                            <div class="upload-preview" id="mediaPreview"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="sellerName">Your Name *</label>
                            <input type="text" id="sellerName" placeholder="Full Name" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sellerPhone">Phone Number *</label>
                                <input type="tel" id="sellerPhone" placeholder="(213) 549883720" required>
                            </div>
                            <div class="form-group">
                                <label for="sellerEmail">Email Address</label>
                                <input type="email" id="sellerEmail" placeholder="your@email.com">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn-submit" id="submitBtn">
                                <i class="fas fa-paper-plane"></i> Submit Car Details
                            </button>
                            <button type="button" class="btn-cancel" id="cancelBtn" style="display: none;">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Process Steps -->
    <section class="process-steps">
        <div class="container">
            <h2 class="section-title">Selling Process</h2>
            <div class="steps-grid">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Submit Details</h3>
                    <p>Fill out the form with your car details and photos</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>Get Valuation</h3>
                    <p>We'll provide you with a fair market valuation</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Schedule Inspection</h3>
                    <p>Book a convenient time for vehicle inspection</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <h3>Receive Payment</h3>
                    <p>Get paid instantly upon agreement</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <a href="index.html" class="logo">
                        <i class="fas fa-car"></i>
                        <span>Khaled Cars</span>
                    </a>
                    <p>Premium car dealership offering the best selection of luxury and family vehicles.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>Quick Links</h3>
                    <a href="index.html">Home</a>
                    <a href="inventory.html">Inventory</a>
                    <a href="add-car.html">Sell Your Car</a>
                    <a href="admin.html">Admin Login</a>
                </div>
                <div class="footer-col">
                    <h3>Contact Info</h3>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Car Street, City</p>
                    <p><i class="fas fa-phone"></i> (123) 456-7890</p>
                    <p><i class="fas fa-envelope"></i> khaledcarsexport.skikda@gmail.com</p>
                    <p><i class="fas fa-clock"></i> Mon-Sat: 9AM-7PM</p>
                </div>
                <div class="footer-col">
                    <h3>Newsletter</h3>
                    <p>Subscribe for latest offers</p>
                    <form class="newsletter-form">
                        <input type="email" placeholder="Your Email" required>
                        <button type="submit">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Khaled Cars. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Modal Gallery -->
    <div class="modal" id="galleryModal">
        <button class="modal-close" onclick="closeModal()">&times;</button>
        <button class="modal-nav prev" onclick="prevModalMedia()">‚ùÆ</button>
        <div class="modal-content">
            <img id="modalImage" class="modal-media" style="display: none;">
            <video id="modalVideo" class="modal-media" controls style="display: none;"></video>
        </div>
        <button class="modal-nav next" onclick="nextModalMedia()">‚ùØ</button>
        <div class="modal-counter" id="modalCounter"></div>
    </div>

    <script src="script.js"></script>
    <script>
        // Form handling for add-car page
        let uploadedMedia = [];
        
        function handleMediaUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('mediaPreview');
            
            for (let file of files) {
                if (file.size > 150 * 1024 * 1024) {
                    showStatus(`File ${file.name} is too large (max 150MB)`, 'error');
                    continue;
                }
                
                uploadedMedia.push(file);
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'upload-preview-item';
                    previewItem.onclick = () => previewMedia(e.target.result, file.type);
                    
                    if (file.type.startsWith('image/')) {
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="${file.name}">
                            <button class="remove-upload" onclick="event.stopPropagation(); removeUploadedMedia('${file.name}')">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else {
                        previewItem.innerHTML = `
                            <video src="${e.target.result}" alt="${file.name}"></video>
                            <button class="remove-upload" onclick="event.stopPropagation(); removeUploadedMedia('${file.name}')">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    }
                    
                    preview.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
            }
            
            event.target.value = '';
        }
        
        function removeUploadedMedia(fileName) {
            uploadedMedia = uploadedMedia.filter(file => file.name !== fileName);
            const items = document.querySelectorAll('.upload-preview-item');
            items.forEach(item => {
                const media = item.querySelector('img, video');
                if (media && media.alt === fileName) {
                    item.remove();
                }
            });
        }
        
        // Handle form submission - FIXED VERSION
async function handleSubmit(event) {
    event.preventDefault();
    
    console.log('üì§ Form submission started');
    
    // Get form values
    const carData = {
        brand: document.getElementById('brand').value,
        model: document.getElementById('model').value,
        year: parseInt(document.getElementById('year').value),
        price: parseFloat(document.getElementById('price').value),
        kilometrage: parseInt(document.getElementById('kilometrage').value),
        boite: document.getElementById('boite').value,
        version: document.getElementById('version').value,
        description: document.getElementById('description').value
    };
    
    console.log('Car data:', carData);
    console.log('Uploaded media count:', uploadedMedia.length);
    
    const formData = new FormData();
    
    // Method 1: Send as JSON string (preferred)
    formData.append('carData', JSON.stringify(carData));
    
    // Method 2: Also add individual fields as backup
    for (const key in carData) {
        formData.append(key, carData[key]);
    }
    
    // Add media files
    if (uploadedMedia.length > 0) {
        console.log('Adding media files to FormData');
        uploadedMedia.forEach((file, index) => {
            console.log(`File ${index + 1}:`, file.name, file.size, file.type);
            formData.append('media', file);
        });
    } else {
        console.log('No media files to upload');
    }
    
    // Log FormData contents
    console.log('FormData entries:');
    for (let pair of formData.entries()) {
        console.log(pair[0] + ':', pair[0] === 'media' ? `File (${pair[1].name})` : pair[1]);
    }
    
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    submitBtn.disabled = true;
    
    try {
        const response = await fetch('/api/cars', {
            method: 'POST',
            body: formData
            // Note: Don't set Content-Type header for FormData
        });
        
        console.log('Response status:', response.status);
        
        const result = await response.json();
        console.log('Server response:', result);
        
        if (result.success) {
            showStatus('Car added successfully! We will contact you soon.', 'success');
            console.log('‚úÖ Car added successfully, ID:', result.id);
            console.log('Media count in response:', result.car ? result.car.media.length : 0);
            
            // Clear form
            document.getElementById('carForm').reset();
            document.getElementById('mediaPreview').innerHTML = '';
            uploadedMedia = [];
            
            // Optional: Redirect to inventory after 2 seconds
            setTimeout(() => {
                window.location.href = 'inventory.html';
            }, 2000);
        } else {
            showStatus(result.error || 'Error saving car', 'error');
            console.error('‚ùå Server error:', result);
        }
    } catch (error) {
        console.error('‚ùå Network error:', error);
        showStatus('Network error. Check if server is running.', 'error');
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
}
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('carForm').addEventListener('submit', handleSubmit);
            
            // Mobile menu toggle
            const menuToggle = document.querySelector('.menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
            });
        });
    </script>
</body>
</html>